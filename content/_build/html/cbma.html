
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Coordinate-Based Meta-Analysis &#8212; NiMARE: Neuroimaging Meta-Analysis Research Environment</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/myfile.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Image-Based Meta-Analysis" href="ibma.html" />
    <link rel="prev" title="External Meta-Analytic Resources" href="resources.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/nimare_overview.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">NiMARE: Neuroimaging Meta-Analysis Research Environment</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="abstract.html">
   Abstract
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  About NiMARE
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="overview.html">
   NiMARE Overview
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Meta-Analytic Databases and Resources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="resources.html">
   External Meta-Analytic Resources
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Meta-Analyses in NiMARE
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Coordinate-Based Meta-Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ibma.html">
   Image-Based Meta-Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="correction.html">
   Multiple Comparisons Correction
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Other Meta-Analytic Approaches
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="about_derivative_analyses.html">
   Derivative Analyses
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="subtraction.html">
   Meta-Analytic Subtraction Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="macm.html">
   Meta-Analytic Coactivation Modeling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="annotation.html">
   Automated Annotation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="decoding.html">
   Meta-Analytic Functional Decoding
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Concluding Thoughts
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="future_directions.html">
   Future Directions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="summary.html">
   Summary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="acknowledgements.html">
   Acknowledgements
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bibliography.html">
   References
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Appendix
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="appendices/brainmap_decoding.html">
   Appendix I: BrainMap Discrete Decoding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="appendices/neurosynth_decoding.html">
   Appendix II: Neurosynth Discrete Decoding
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="_sources/cbma.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/cbma.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/NBCLab/nimare-paper/master?urlpath=tree/content/cbma.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cbma-kernels">
   CBMA kernels
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#multilevel-kernel-density-analysis">
   Multilevel kernel density analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-metaresult-class">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       MetaResult
      </span>
     </code>
     class
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#kernel-density-analysis">
   Kernel density analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#activation-likelihood-estimation">
   Activation likelihood estimation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#specific-coactivation-likelihood-estimation">
   Specific coactivation likelihood estimation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mkda-chi-squared-analysis">
   MKDA Chi-Squared Analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparing-algorithms">
   Comparing algorithms
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="coordinate-based-meta-analysis">
<h1>Coordinate-Based Meta-Analysis<a class="headerlink" href="#coordinate-based-meta-analysis" title="Permalink to this headline">¶</a></h1>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First, import the necessary modules and functions</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">plotting</span>

<span class="kn">import</span> <span class="nn">nimare</span>

<span class="c1"># Define where data files will be located</span>
<span class="n">DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;../data&quot;</span><span class="p">)</span>
<span class="n">FIG_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;../images&quot;</span><span class="p">)</span>

<span class="c1"># Now, load the Datasets we will use in this chapter</span>
<span class="n">sleuth_dset1</span> <span class="o">=</span> <span class="n">nimare</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="s2">&quot;sleuth_dset1.pkl.gz&quot;</span><span class="p">))</span>
<span class="n">sleuth_dset2</span> <span class="o">=</span> <span class="n">nimare</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="s2">&quot;sleuth_dset2.pkl.gz&quot;</span><span class="p">))</span>
<span class="n">neurosynth_dset</span> <span class="o">=</span> <span class="n">nimare</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="s2">&quot;neurosynth_dataset.pkl.gz&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/data/nbc/misc-projects/Salo_NiMARE/conda_env/lib/python3.7/site-packages/nilearn/datasets/__init__.py:90: FutureWarning: Fetchers from the nilearn.datasets module will be updated in version 0.9 to return python strings instead of bytes and Pandas dataframes instead of Numpy arrays.
  &quot;Numpy arrays.&quot;, FutureWarning)
</pre></div>
</div>
</div>
</div>
<p>Coordinate-based meta-analysis (CBMA) is currently the most popular method for neuroimaging meta-analysis, given that the majority of fMRI papers currently report their findings as peaks of statistically significant clusters in standard space and do not release unthresholded statistical maps.
These peaks indicate where significant results were found in the brain, and thus do not reflect an effect size estimate for each hypothesis test (i.e., each voxel) as one would expect for a typical meta-analysis.
As such, standard methods for effect size-based meta-analysis cannot be applied.
Over the past two decades, a number of algorithms have been developed to determine whether peaks converge across experiments in order to identify locations of consistent or specific activation associated with a given hypothesis <span id="id1">[<a class="reference internal" href="bibliography.html#id79">Samartsidis <em>et al.</em>, 2017</a>, <a class="reference internal" href="bibliography.html#id61">Müller <em>et al.</em>, 2018</a>]</span>.</p>
<p>Kernel-based methods evaluate convergence of coordinates across studies by first convolving foci with a spatial kernel to produce study-specific modeled activation maps, then combining those modeled activation maps into a sample-wise map, which is compared to a null distribution to evaluate voxel-wise statistical significance.
Additionally, for each of the following approaches, except for SCALE, voxel- or cluster-level multiple comparisons correction may be performed using Monte Carlo simulations or false discovery rate (FDR) <span id="id2">[<a class="reference internal" href="bibliography.html#id44">Laird <em>et al.</em>, 2005</a>]</span> correction. Basic multiple-comparisons correction methods (e.g., Bonferroni correction) are also supported.</p>
<div class="figure align-center" id="meta-workflow-fig">
<img alt="_images/figure_02.png" src="_images/figure_02.png" />
<p class="caption"><span class="caption-number">Fig. 3 </span><span class="caption-text">A flowchart of the typical workflow for coordinate-based meta-analyses in NiMARE.</span><a class="headerlink" href="#meta-workflow-fig" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="cbma-kernels">
<h2>CBMA kernels<a class="headerlink" href="#cbma-kernels" title="Permalink to this headline">¶</a></h2>
<p>CBMA kernels are available as <a class="reference external" href="https://nimare.readthedocs.io/en/0.0.10/generated/nimare.meta.kernel.KernelTransformer.html#nimare.meta.kernel.KernelTransformer" title="(in NiMARE v0.0.10+0.ge8814c2.dirty)"><code class="xref py py-class docutils literal notranslate"><span class="pre">nimare.meta.kernel.KernelTransformer</span></code></a>s in the <a class="reference external" href="https://nimare.readthedocs.io/en/0.0.10/generated/nimare.meta.kernel.html#module-nimare.meta.kernel" title="(in NiMARE v0.0.10+0.ge8814c2.dirty)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">nimare.meta.kernel</span></code></a> module.
There are three standard kernels that are currently available: <a class="reference external" href="https://nimare.readthedocs.io/en/0.0.10/generated/nimare.meta.kernel.MKDAKernel.html#nimare.meta.kernel.MKDAKernel" title="(in NiMARE v0.0.10+0.ge8814c2.dirty)"><code class="xref py py-class docutils literal notranslate"><span class="pre">nimare.meta.kernel.MKDAKernel</span></code></a>, <a class="reference external" href="https://nimare.readthedocs.io/en/0.0.10/generated/nimare.meta.kernel.KDAKernel.html#nimare.meta.kernel.KDAKernel" title="(in NiMARE v0.0.10+0.ge8814c2.dirty)"><code class="xref py py-class docutils literal notranslate"><span class="pre">nimare.meta.kernel.KDAKernel</span></code></a>, and <a class="reference external" href="https://nimare.readthedocs.io/en/0.0.10/generated/nimare.meta.kernel.ALEKernel.html#nimare.meta.kernel.ALEKernel" title="(in NiMARE v0.0.10+0.ge8814c2.dirty)"><code class="xref py py-class docutils literal notranslate"><span class="pre">nimare.meta.kernel.ALEKernel</span></code></a>.
Each class may be configured with certain parameters when a new object is initialized.
For example, <code class="docutils literal notranslate"><span class="pre">MKDAKernel</span></code> accepts an <code class="docutils literal notranslate"><span class="pre">r</span></code> parameter, which determines the radius of the spheres that will be created around each peak coordinate.
<code class="docutils literal notranslate"><span class="pre">ALEKernel</span></code> automatically uses the sample size associated with each experiment in the <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> to determine the appropriate full-width-at-half-maximum of its Gaussian distribution, as described in <span id="id3">Eickhoff <em>et al.</em> [<a class="reference internal" href="bibliography.html#id98">2012</a>]</span>; however, users may provide a constant <code class="docutils literal notranslate"><span class="pre">sample_size</span></code> or <code class="docutils literal notranslate"><span class="pre">fwhm</span></code> parameter when sample size information is not available within the <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> metadata.</p>
<p>Here we show how these three kernels can be applied to the same <code class="docutils literal notranslate"><span class="pre">Dataset</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nimare.meta</span> <span class="kn">import</span> <span class="n">kernel</span>

<span class="n">mkda_kernel</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">MKDAKernel</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">mkda_ma_maps</span> <span class="o">=</span> <span class="n">mkda_kernel</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sleuth_dset1</span><span class="p">)</span>
<span class="n">kda_kernel</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">KDAKernel</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">kda_ma_maps</span> <span class="o">=</span> <span class="n">kda_kernel</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sleuth_dset1</span><span class="p">)</span>
<span class="n">ale_kernel</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">ALEKernel</span><span class="p">(</span><span class="n">sample_size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ale_ma_maps</span> <span class="o">=</span> <span class="n">ale_kernel</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sleuth_dset1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ERROR:nimare.meta.kernel:transform failed, removing None
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>---------------------------------------------------------------------------
FileNotFoundError                         Traceback (most recent call last)
/tmp/ipykernel_477/3276642501.py in &lt;module&gt;
      2 
      3 mkda_kernel = kernel.MKDAKernel(r=10)
----&gt; 4 mkda_ma_maps = mkda_kernel.transform(sleuth_dset1)
      5 kda_kernel = kernel.KDAKernel(r=10)
      6 kda_ma_maps = kda_kernel.transform(sleuth_dset1)

/home/data/nbc/misc-projects/Salo_NiMARE/conda_env/lib/python3.7/site-packages/nimare/utils.py in memmap_context(self, *args, **kwargs)
    471 
    472             try:
--&gt; 473                 return function(self, *args, **kwargs)
    474             except:
    475                 for filename in filenames:

/home/data/nbc/misc-projects/Salo_NiMARE/conda_env/lib/python3.7/site-packages/nimare/meta/kernel.py in transform(self, dataset, masker, return_type)
    182         elif return_type == &quot;image&quot;:
    183             dtype = type(self.value) if hasattr(self, &quot;value&quot;) else float
--&gt; 184             mask_data = mask.get_fdata().astype(dtype)
    185         elif return_type == &quot;dataset&quot;:
    186             if dataset.basepath is None:

/home/data/nbc/misc-projects/Salo_NiMARE/conda_env/lib/python3.7/site-packages/nibabel/dataobj_images.py in get_fdata(self, caching, dtype)
    353         # For array proxies, will attempt to confine data array to dtype
    354         # during scaling
--&gt; 355         data = np.asanyarray(self._dataobj, dtype=dtype)
    356         if caching == &#39;fill&#39;:
    357             self._fdata_cache = data

/home/data/nbc/misc-projects/Salo_NiMARE/conda_env/lib/python3.7/site-packages/nibabel/arrayproxy.py in __array__(self, dtype)
    389             Scaled image data with type `dtype`.
    390         &quot;&quot;&quot;
--&gt; 391         arr = self._get_scaled(dtype=dtype, slicer=())
    392         if dtype is not None:
    393             arr = arr.astype(dtype, copy=False)

/home/data/nbc/misc-projects/Salo_NiMARE/conda_env/lib/python3.7/site-packages/nibabel/arrayproxy.py in _get_scaled(self, dtype, slicer)
    356             scl_inter = scl_inter.astype(use_dtype)
    357         # Read array and upcast as necessary for big slopes, intercepts
--&gt; 358         scaled = apply_read_scaling(self._get_unscaled(slicer=slicer), scl_slope, scl_inter)
    359         if dtype is not None:
    360             scaled = scaled.astype(np.promote_types(scaled.dtype, dtype), copy=False)

/home/data/nbc/misc-projects/Salo_NiMARE/conda_env/lib/python3.7/site-packages/nibabel/arrayproxy.py in _get_unscaled(self, slicer)
    329         if canonical_slicers(slicer, self._shape, False) == \
    330                 canonical_slicers((), self._shape, False):
--&gt; 331             with self._get_fileobj() as fileobj, self._lock:
    332                 return array_from_file(self._shape,
    333                                        self._dtype,

/home/data/nbc/misc-projects/Salo_NiMARE/conda_env/lib/python3.7/contextlib.py in __enter__(self)
    110         del self.args, self.kwds, self.func
    111         try:
--&gt; 112             return next(self.gen)
    113         except StopIteration:
    114             raise RuntimeError(&quot;generator didn&#39;t yield&quot;) from None

/home/data/nbc/misc-projects/Salo_NiMARE/conda_env/lib/python3.7/site-packages/nibabel/arrayproxy.py in _get_fileobj(self)
    323         else:
    324             with openers.ImageOpener(
--&gt; 325                     self.file_like, keep_open=False) as opener:
    326                 yield opener
    327 

/home/data/nbc/misc-projects/Salo_NiMARE/conda_env/lib/python3.7/site-packages/nibabel/openers.py in __init__(self, fileish, *args, **kwargs)
    111         else:
    112             kwargs.pop(&#39;keep_open&#39;, None)
--&gt; 113         self.fobj = opener(fileish, *args, **kwargs)
    114         self._name = fileish
    115         self.me_opened = True

FileNotFoundError: [Errno 2] No such file or directory: &#39;/home/data/nbc/misc-projects/Salo_NiMARE/nimare-paper/conda_env/lib/python3.7/site-packages/nimare/resources/templates/MNI152_2x2x2_brainmask.nii&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here we delete the recent variables for the sake of reducing memory usage</span>
<span class="k">del</span> <span class="n">mkda_kernel</span><span class="p">,</span> <span class="n">kda_kernel</span><span class="p">,</span> <span class="n">ale_kernel</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate figure</span>
<span class="n">study_idx</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># a study with overlapping kernels</span>
<span class="n">max_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">kda_ma_maps</span><span class="p">[</span><span class="n">study_idx</span><span class="p">]</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">ma_maps</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;MKDA Kernel&quot;</span><span class="p">:</span> <span class="n">mkda_ma_maps</span><span class="p">[</span><span class="n">study_idx</span><span class="p">],</span>
    <span class="s2">&quot;KDA Kernel&quot;</span><span class="p">:</span> <span class="n">kda_ma_maps</span><span class="p">[</span><span class="n">study_idx</span><span class="p">],</span>
    <span class="s2">&quot;ALE Kernel&quot;</span><span class="p">:</span> <span class="n">ale_ma_maps</span><span class="p">[</span><span class="n">study_idx</span><span class="p">],</span>
<span class="p">}</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i_meta</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ma_maps</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="k">if</span> <span class="s2">&quot;ALE&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">max_value</span>

    <span class="n">display</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span>
        <span class="n">img</span><span class="p">,</span>
        <span class="n">annotate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i_meta</span><span class="p">],</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds&quot;</span><span class="p">,</span>
        <span class="n">cut_coords</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">29</span><span class="p">],</span>
        <span class="n">draw_cross</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i_meta</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="n">colorbar</span> <span class="o">=</span> <span class="n">display</span><span class="o">.</span><span class="n">_cbar</span>
    <span class="n">colorbar_ticks</span> <span class="o">=</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">colorbar_ticks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">new_ticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">colorbar_ticks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">colorbar_ticks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_ticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">colorbar_ticks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colorbar_ticks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">colorbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">new_ticks</span><span class="p">,</span> <span class="n">update_ticks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;figure_ma_maps&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here we delete the recent variables for the sake of reducing memory usage</span>
<span class="k">del</span> <span class="n">mkda_ma_maps</span><span class="p">,</span> <span class="n">kda_ma_maps</span><span class="p">,</span> <span class="n">ale_ma_maps</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-center" id="figure-ma-maps">
<p class="caption"><span class="caption-number">Fig. 4 </span><span class="caption-text">Modeled activation maps produced by NiMARE’s <code class="docutils literal notranslate"><span class="pre">KernelTransformer</span></code> classes.</span><a class="headerlink" href="#figure-ma-maps" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="multilevel-kernel-density-analysis">
<span id="content-cbma-mkdad"></span><h2>Multilevel kernel density analysis<a class="headerlink" href="#multilevel-kernel-density-analysis" title="Permalink to this headline">¶</a></h2>
<p><strong>Multilevel kernel density analysis</strong> (MKDA) <span id="id4">[<a class="reference internal" href="bibliography.html#id57">Wager <em>et al.</em>, 2007</a>]</span> is a kernel-based method that convolves each peak from each study with a binary sphere of a set radius.
These peak-specific binary maps are then combined into study-specific maps by taking the maximum value for each voxel.
Study-specific maps are then averaged across the meta-analytic sample.
This averaging is generally weighted by studies’ sample sizes, although other covariates may be included, such as weights based on the type of inference (random or fixed effects) employed in the study’s analysis.
An arbitrary threshold is generally employed to zero-out voxels with very low values, and then a Monte Carlo procedure is used to assess statistical significance, either at the voxel or cluster level.</p>
<p>In NiMARE, the MKDA meta-analyses can be performed with the <a class="reference external" href="https://nimare.readthedocs.io/en/0.0.10/generated/nimare.meta.cbma.mkda.MKDADensity.html#nimare.meta.cbma.mkda.MKDADensity" title="(in NiMARE v0.0.10+0.ge8814c2.dirty)"><code class="xref py py-class docutils literal notranslate"><span class="pre">nimare.meta.cbma.mkda.MKDADensity</span></code></a> class.
This class, like most other CBMA classes in NiMARE, accepts a <code class="docutils literal notranslate"><span class="pre">null_method</span></code> parameter, which determines how voxel-wise (uncorrected) statistical significance is calculated.</p>
<div class="tip admonition">
<p class="admonition-title">On CBMA “null methods”</p>
<p>The <code class="docutils literal notranslate"><span class="pre">null_method</span></code> parameter allows two options: “approximate” or “montecarlo.”
The “approximate” option builds a histogram-based null distribution of summary-statistic values, which can then be used to determine the associated p-value for <em>observed</em> summary-statistic values (i.e., the values in the meta-analytic map).
The “montecarlo” option builds a null distribution of summary-statistic values by randomly shuffling the coordinates the <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> many times, and computing the summary-statistic values for each permutation.
In general, the “montecarlo” method is slightly more accurate when there are enough permutations, while the “approximate” method is much faster.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Fitting the CBMA <code class="docutils literal notranslate"><span class="pre">Estimator</span></code> to a <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> will produce p-value, z-statistic, and summary-statistic maps, but these are not corrected for multiple comparisons.</p>
<p>When performing a meta-analysis with the goal of statistical inference, you will want to perform multiple comparisons correction with NiMARE’s <code class="docutils literal notranslate"><span class="pre">Corrector</span></code>
classes.
Please see the multiple comparisons correction chapter for more information.</p>
</div>
<p>Here we perform an MKDADensity meta-analysis on one of the Sleuth-based Datasets.
We will use the “approximate” null method for speed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nimare.meta.cbma</span> <span class="kn">import</span> <span class="n">mkda</span>

<span class="n">mkdad_meta</span> <span class="o">=</span> <span class="n">mkda</span><span class="o">.</span><span class="n">MKDADensity</span><span class="p">(</span><span class="n">null_method</span><span class="o">=</span><span class="s2">&quot;approximate&quot;</span><span class="p">)</span>
<span class="n">mkdad_results</span> <span class="o">=</span> <span class="n">mkdad_meta</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sleuth_dset1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-metaresult-class">
<span id="content-cbma-metaresult"></span><h3>The <code class="docutils literal notranslate"><span class="pre">MetaResult</span></code> class<a class="headerlink" href="#the-metaresult-class" title="Permalink to this headline">¶</a></h3>
<p>Fitting an <code class="docutils literal notranslate"><span class="pre">Estimator</span></code> to a <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> produces a <a class="reference external" href="https://nimare.readthedocs.io/en/0.0.10/generated/nimare.results.MetaResult.html#nimare.results.MetaResult" title="(in NiMARE v0.0.10+0.ge8814c2.dirty)"><code class="xref py py-class docutils literal notranslate"><span class="pre">nimare.results.MetaResult</span></code></a> object.
The <code class="docutils literal notranslate"><span class="pre">MetaResult</span></code> class is a light container holding the different statistical maps produced by the <code class="docutils literal notranslate"><span class="pre">Estimator</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">mkdad_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This result is also retained as an attribute in the <code class="docutils literal notranslate"><span class="pre">Estimator</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">mkdad_meta</span><span class="o">.</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">maps</span></code> attribute is a dictionary containing statistical map names and associated numpy arrays.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pprint</span><span class="p">(</span><span class="n">mkdad_results</span><span class="o">.</span><span class="n">maps</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>These arrays can be transformed into image-like objects using the <code class="docutils literal notranslate"><span class="pre">masker</span></code> attribute.
We can also use the <code class="docutils literal notranslate"><span class="pre">get_map</span></code> method to get that image object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mkdad_img</span> <span class="o">=</span> <span class="n">mkdad_results</span><span class="o">.</span><span class="n">get_map</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mkdad_img</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can save the statistical maps to an output directory as gzipped nifti files, with a prefix.
Here, we will save all of the statistical maps with the MKDADensity prefix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mkdad_results</span><span class="o">.</span><span class="n">save_maps</span><span class="p">(</span><span class="n">output_dir</span><span class="o">=</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;MKDADensity&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We will also save the <code class="docutils literal notranslate"><span class="pre">Estimator</span></code> itself, which we will reuse when we get to multiple comparisons correction.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mkdad_meta</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="s2">&quot;MKDADensity.pkl.gz&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here we delete the recent variables for the sake of reducing memory usage</span>
<span class="k">del</span> <span class="n">mkdad_meta</span><span class="p">,</span> <span class="n">mkdad_results</span>
</pre></div>
</div>
</div>
</div>
<p>Since this is a kernel-based algorithm, the kernel transformer is an optional input to the meta-analytic estimator, and can be controlled in a more fine-grained manner.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># These two approaches (initializing the kernel ahead of time or</span>
<span class="c1"># providing the arguments with the kernel__ prefix) are equivalent.</span>
<span class="n">mkda_kernel</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">MKDAKernel</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">mkdad_meta</span> <span class="o">=</span> <span class="n">mkda</span><span class="o">.</span><span class="n">MKDADensity</span><span class="p">(</span><span class="n">kernel_transformer</span><span class="o">=</span><span class="n">mkda_kernel</span><span class="p">)</span>
<span class="n">mkdad_meta</span> <span class="o">=</span> <span class="n">mkda</span><span class="o">.</span><span class="n">MKDADensity</span><span class="p">(</span><span class="n">kernel_transformer</span><span class="o">=</span><span class="n">kernel</span><span class="o">.</span><span class="n">MKDAKernel</span><span class="p">,</span> <span class="n">kernel__r</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># A completely different kernel could even be provided, although this is not</span>
<span class="c1"># recommended and should only be used for testing algorithms.</span>
<span class="n">mkdad_meta</span> <span class="o">=</span> <span class="n">mkda</span><span class="o">.</span><span class="n">MKDADensity</span><span class="p">(</span><span class="n">kernel_transformer</span><span class="o">=</span><span class="n">kernel</span><span class="o">.</span><span class="n">KDAKernel</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here we delete the recent variables for the sake of reducing memory usage</span>
<span class="k">del</span> <span class="n">mkda_kernel</span><span class="p">,</span> <span class="n">mkdad_meta</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="kernel-density-analysis">
<h2>Kernel density analysis<a class="headerlink" href="#kernel-density-analysis" title="Permalink to this headline">¶</a></h2>
<p><strong>Kernel density analysis</strong> (KDA) <span id="id5">[<a class="reference internal" href="bibliography.html#id59">Wager <em>et al.</em>, 2003</a>, <a class="reference internal" href="bibliography.html#id16">Wager <em>et al.</em>, 2004</a>]</span> is a precursor algorithm that has been replaced in the field by MKDA.
For the sake of completeness, NiMARE also includes a KDA estimator that implements the older KDA algorithm for comparison purposes.
The interface is virtually identical, but since there are few if any legitimate uses of KDA (which models studies as fixed rather than random effects), we do not discuss the algorithm further here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kda_meta</span> <span class="o">=</span> <span class="n">mkda</span><span class="o">.</span><span class="n">KDA</span><span class="p">(</span><span class="n">null_method</span><span class="o">=</span><span class="s2">&quot;approximate&quot;</span><span class="p">)</span>
<span class="n">kda_results</span> <span class="o">=</span> <span class="n">kda_meta</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sleuth_dset1</span><span class="p">)</span>

<span class="c1"># Retain the z-statistic map for later use</span>
<span class="n">kda_img</span> <span class="o">=</span> <span class="n">kda_results</span><span class="o">.</span><span class="n">get_map</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here we delete the recent variables for the sake of reducing memory usage</span>
<span class="k">del</span> <span class="n">kda_meta</span><span class="p">,</span> <span class="n">kda_results</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="activation-likelihood-estimation">
<h2>Activation likelihood estimation<a class="headerlink" href="#activation-likelihood-estimation" title="Permalink to this headline">¶</a></h2>
<p><strong>Activation likelihood estimation</strong> (ALE) <span id="id6">[<a class="reference internal" href="bibliography.html#id65">Eickhoff <em>et al.</em>, 2012</a>, <a class="reference internal" href="bibliography.html#id40">Turkeltaub <em>et al.</em>, 2012</a>, <a class="reference internal" href="bibliography.html#id7">Turkeltaub <em>et al.</em>, 2002</a>]</span> assesses convergence of peaks across studies by first generating a modeled activation map for each study, in which each of the experiment’s peaks is convolved with a 3D Gaussian distribution determined by the experiment’s sample size, and then by combining these modeled activation maps across studies into an ALE map, which is compared to an empirical null distribution to assess voxel-wise statistical significance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nimare.meta.cbma</span> <span class="kn">import</span> <span class="n">ale</span>

<span class="n">ale_meta</span> <span class="o">=</span> <span class="n">ale</span><span class="o">.</span><span class="n">ALE</span><span class="p">()</span>
<span class="n">ale_results</span> <span class="o">=</span> <span class="n">ale_meta</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sleuth_dset1</span><span class="p">)</span>

<span class="c1"># Retain the z-statistic map for later use</span>
<span class="n">ale_img</span> <span class="o">=</span> <span class="n">ale_results</span><span class="o">.</span><span class="n">get_map</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here we delete the recent variables for the sake of reducing memory usage</span>
<span class="k">del</span> <span class="n">ale_meta</span><span class="p">,</span> <span class="n">ale_results</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="specific-coactivation-likelihood-estimation">
<h2>Specific coactivation likelihood estimation<a class="headerlink" href="#specific-coactivation-likelihood-estimation" title="Permalink to this headline">¶</a></h2>
<p><strong>Specific coactivation likelihood estimation</strong> (SCALE) <span id="id7">[<a class="reference internal" href="bibliography.html#id84">Langner <em>et al.</em>, 2014</a>]</span> is an extension of the ALE algorithm developed for meta-analytic coactivation modeling (MACM) analyses.
Rather than comparing convergence of foci within the sample to a null distribution derived under the assumption of spatial randomness within the brain, SCALE assesses whether the convergence at each voxel is greater than in the general literature.
Each voxel in the brain is assigned a null distribution determined based on the base rate of activation for that voxel across an existing coordinate-based meta-analytic database.
This approach allows for the generation of a statistical map for the sample, but no methods for multiple comparisons correction have yet been developed.
While this method was developed to support analysis of joint activation or “coactivation” patterns, it is generic and can be applied to any CBMA; see <a class="reference internal" href="about_derivative_analyses.html"><span class="doc std std-doc">Derivative Analyses</span></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here we use the coordinates from Neurosynth as our measure of coordinate</span>
<span class="c1"># base-rates, because we do not have access to the full BrainMap database.</span>
<span class="c1"># However, one assumption of SCALE is that the Dataset being analyzed comes</span>
<span class="c1"># from the same source as the database you use for calculating base-rates.</span>
<span class="n">xyz</span> <span class="o">=</span> <span class="n">neurosynth_dset</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
<span class="n">scale_meta</span> <span class="o">=</span> <span class="n">ale</span><span class="o">.</span><span class="n">SCALE</span><span class="p">(</span><span class="n">n_iters</span><span class="o">=</span><span class="mi">2500</span><span class="p">,</span> <span class="n">xyz</span><span class="o">=</span><span class="n">xyz</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">scale_results</span> <span class="o">=</span> <span class="n">scale_meta</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sleuth_dset1</span><span class="p">)</span>

<span class="c1"># Retain the z-statistic map for later use</span>
<span class="n">scale_img</span> <span class="o">=</span> <span class="n">scale_results</span><span class="o">.</span><span class="n">get_map</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here we delete the recent variables for the sake of reducing memory usage</span>
<span class="k">del</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">scale_meta</span><span class="p">,</span> <span class="n">scale_results</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="mkda-chi-squared-analysis">
<h2>MKDA Chi-Squared Analysis<a class="headerlink" href="#mkda-chi-squared-analysis" title="Permalink to this headline">¶</a></h2>
<p>An alternative to the density-based approaches (i.e., MKDA, KDA, ALE, and SCALE) is the <strong>MKDA Chi-squared</strong> extension <span id="id8">[<a class="reference internal" href="bibliography.html#id57">Wager <em>et al.</em>, 2007</a>]</span>.
Though still a kernel-based method in which foci are convolved with a binary sphere and combined within studies, this approach uses voxel-wise chi-squared tests to assess both consistency (i.e., higher convergence of foci within the meta-analytic sample than expected by chance) and specificity (i.e., higher convergence of foci within the meta-analytic sample than detected in an unrelated dataset) of activation.
Such an analysis also requires access to a reference meta-analytic sample or database of studies.
For example, to perform a chi-squared analysis of working memory studies, the researcher will also need a comprehensive set of studies which did not manipulate working memory—ideally one that is matched with the working memory study set on all relevant attributes <em>except</em> the involvement of working memory.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mkdac_meta</span> <span class="o">=</span> <span class="n">mkda</span><span class="o">.</span><span class="n">MKDAChi2</span><span class="p">()</span>
<span class="n">mkdac_results</span> <span class="o">=</span> <span class="n">mkdac_meta</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sleuth_dset1</span><span class="p">,</span> <span class="n">sleuth_dset2</span><span class="p">)</span>

<span class="c1"># Retain the specificity analysis&#39;s z-statistic map for later use</span>
<span class="n">mkdac_img</span> <span class="o">=</span> <span class="n">mkdac_results</span><span class="o">.</span><span class="n">get_map</span><span class="p">(</span><span class="s2">&quot;z_desc-specificity&quot;</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here we delete the recent variables for the sake of reducing memory usage</span>
<span class="k">del</span> <span class="n">mkdac_meta</span><span class="p">,</span> <span class="n">mkdac_results</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="comparing-algorithms">
<h2>Comparing algorithms<a class="headerlink" href="#comparing-algorithms" title="Permalink to this headline">¶</a></h2>
<p>Here we load the z-statistic map from each of the CBMA Estimators we’ve used throughout this chapter and plot them all side by side.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">meta_results</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;MKDA Density&quot;</span><span class="p">:</span> <span class="n">mkdad_img</span><span class="p">,</span>
    <span class="s2">&quot;MKDA Chi-Squared&quot;</span><span class="p">:</span> <span class="n">mkdac_img</span><span class="p">,</span>
    <span class="s2">&quot;KDA&quot;</span><span class="p">:</span> <span class="n">kda_img</span><span class="p">,</span>
    <span class="s2">&quot;ALE&quot;</span><span class="p">:</span> <span class="n">ale_img</span><span class="p">,</span>
    <span class="s2">&quot;SCALE&quot;</span><span class="p">:</span> <span class="n">scale_img</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">order</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;MKDA Density&quot;</span><span class="p">,</span> <span class="s2">&quot;ALE&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;MKDA Chi-Squared&quot;</span><span class="p">,</span> <span class="s2">&quot;SCALE&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;KDA&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i_row</span><span class="p">,</span> <span class="n">row_names</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j_col</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row_names</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i_row</span><span class="p">,</span> <span class="n">j_col</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">img</span> <span class="o">=</span> <span class="n">meta_results</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;MKDA Chi-Squared&quot;</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;RdBu_r&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;Reds&quot;</span>

        <span class="n">display</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span>
            <span class="n">img</span><span class="p">,</span>
            <span class="n">annotate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i_row</span><span class="p">,</span> <span class="n">j_col</span><span class="p">],</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">cut_coords</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
            <span class="n">draw_cross</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i_row</span><span class="p">,</span> <span class="n">j_col</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="n">colorbar</span> <span class="o">=</span> <span class="n">display</span><span class="o">.</span><span class="n">_cbar</span>
        <span class="n">colorbar_ticks</span> <span class="o">=</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">colorbar_ticks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">new_ticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">colorbar_ticks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">colorbar_ticks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_ticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">colorbar_ticks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colorbar_ticks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">colorbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">new_ticks</span><span class="p">,</span> <span class="n">update_ticks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;figure_cbma_uncorr&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-center" id="figure-cbma-uncorr">
<p class="caption"><span class="caption-number">Fig. 5 </span><span class="caption-text">Thresholded results from MKDA Density, KDA, ALE, and SCALE meta-analyses.</span><a class="headerlink" href="#figure-cbma-uncorr" title="Permalink to this image">¶</a></p>
</div>
<p>A number of other coordinate-based meta-analysis algorithms exist which are not yet implemented in NiMARE.
We describe these algorithms briefly in <a class="reference internal" href="future_directions.html"><span class="doc std std-doc">Future Directions</span></a>.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="resources.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">External Meta-Analytic Resources</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="ibma.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Image-Based Meta-Analysis</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Taylor Salo, Tal Yarkoni, Thomas E. Nichols, Jean-Baptiste Poline, Murat Bilgel, Katherine L. Bottenhorn, Enrico Glerean, Dorota Jarecka, James D. Kent, Adam Kimbler, Dylan M. Nielson, Kendra M. Oudyk, Alexandre Pérez, Puck C. Reeders, Julio A. Yanes, Julio A. Peraza, and Angela R. Laird<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>